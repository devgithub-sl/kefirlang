(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const e of i)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const e={};return i.integrity&&(e.integrity=i.integrity),i.referrerPolicy&&(e.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?e.credentials="include":i.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function l(i){if(i.ep)return;i.ep=!0;const e=n(i);fetch(i.href,e)}})();const _=new Set(["entry","def","defn","return","print","if","else","while","for","in","input","mut","let","break","continue","struct","defer","html","match","case","default"]),O=new Set(["True","False"]);function A(o){const t=[];let n=0,l=1;for(;n<o.length;){const i=o[n];if(/\s/.test(i)){i===`
`&&l++,n++;continue}if(i==="/"&&o[n+1]==="/"){for(;n<o.length&&o[n]!==`
`;)n++;continue}if(/[0-9]/.test(i)){let r="";for(;n<o.length&&/[0-9.]/.test(o[n]);)r+=o[n++];t.push({type:"NUMBER",value:r,line:l});continue}if(i==='"'){let r="";n++;let a=!1;for(;n<o.length;){if(o[n]==='"'){a=!0;break}o[n]===`
`&&l++,r+=o[n++]}if(!a)return console.error(`Unterminated string at line ${l}`),t.push({type:"STRING",value:r,line:l}),t;n++,t.push({type:"STRING",value:r,line:l});continue}if(i==="'"){let r="";n++,n<o.length&&(r=o[n++]),o[n]==="'"&&n++,t.push({type:"CHAR",value:r,line:l});continue}if(/[a-zA-Z_]/.test(i)){let r="";for(;n<o.length&&/[a-zA-Z0-9_"]/.test(o[n]);)r+=o[n++];_.has(r)?t.push({type:"KEYWORD",value:r,line:l}):O.has(r)?t.push({type:"BOOLEAN",value:r,line:l}):t.push({type:"IDENTIFIER",value:r,line:l});continue}const e=o.substr(n,2);if([":;","==","!=",">=","<=","&&","||","??","?.","->"].includes(e)){[":;"].includes(e)?t.push({type:"PUNCTUATION",value:e,line:l}):t.push({type:"OPERATOR",value:e,line:l}),n+=2;continue}if(["+","-","*","/",">","<","%"].includes(i)){t.push({type:"OPERATOR",value:i,line:l}),n++;continue}if(["=",";",":","(",")",",",".","[","]","{","}","$"].includes(i)){t.push({type:"PUNCTUATION",value:i,line:l}),n++;continue}console.warn(`Unknown character: ${i} at line ${l}`),n++}return t.push({type:"EOF",value:"",line:l}),t}class B{globalVariables=new Map;functions=new Map;structs=new Map;nativeFunctions=new Map;scopeStack=[];constructor(){this.initNativeFunctions(),this.scopeStack=[this.globalVariables]}reset(t=!1){t||(this.globalVariables.clear(),this.functions.clear(),this.structs.clear(),this.scopeStack=[this.globalVariables]),this.initNativeFunctions()}initNativeFunctions(){this.nativeFunctions.clear(),this.nativeFunctions.set("range",t=>{if(t.length<2)return[];const n=t[0],l=t[1],i=[];for(let e=n;e<l;e++)i.push(e);return i}),this.nativeFunctions.set("floor",t=>Math.floor(t[0])),this.nativeFunctions.set("ceil",t=>Math.ceil(t[0])),this.nativeFunctions.set("sqrt",t=>Math.sqrt(t[0])),this.nativeFunctions.set("random",()=>Math.random()),this.nativeFunctions.set("sin",t=>Math.sin(t[0])),this.nativeFunctions.set("cos",t=>Math.cos(t[0])),this.nativeFunctions.set("str",t=>String(t[0])),this.nativeFunctions.set("int",t=>parseInt(t[0])),this.nativeFunctions.set("typeof",t=>Array.isArray(t[0])?"array":t[0]===null?"null":typeof t[0]=="object"&&t[0].__struct_type?t[0].__struct_type:typeof t[0]),this.nativeFunctions.set("len",t=>Array.isArray(t[0])||typeof t[0]=="string"?t[0].length:typeof t[0]=="object"&&t[0]!==null?Object.keys(t[0]).length:0),this.nativeFunctions.set("push",t=>Array.isArray(t[0])?(t[0].push(t[1]),t[0]):null),this.nativeFunctions.set("pop",t=>Array.isArray(t[0])?t[0].pop():null),this.nativeFunctions.set("keys",t=>typeof t[0]=="object"&&t[0]!==null?Object.keys(t[0]):[])}getVar(t){for(let n=this.scopeStack.length-1;n>=0;n--){const l=this.scopeStack[n];if(l.has(t))return l.get(t)}}defineVar(t,n,l,i){this.scopeStack[this.scopeStack.length-1].set(t,{value:n,isMutable:l,type:i})}assignVar(t,n,l,i){const e=this.getVar(t);if(e){if(!e.isMutable){i({type:"error",message:`Runtime Error: Cannot reassign immutable variable '${t}'`,line:l});return}if(e.type&&!this.checkType(n,e.type)){i({type:"error",message:`Type Error: Variable '${t}' expects '${e.type}'`,line:l});return}e.value=n}else this.defineVar(t,n,!1,null)}assignIndex(t,n,l,i,e){const r=this.getVar(t);if(!r||!r.isMutable){e({type:"error",message:`Runtime Error: Cannot mutate '${t}'`,line:i});return}if(Array.isArray(r.value)){if(typeof n!="number"){e({type:"error",message:"Runtime Error: Array index must be a number",line:i});return}if(n<0||n>=r.value.length){e({type:"error",message:`Runtime Error: Index ${n} out of bounds`,line:i});return}r.value[n]=l}else typeof r.value=="object"&&r.value!==null?r.value[n]=l:e({type:"error",message:`Runtime Error: '${t}' is not indexable`,line:i})}checkType(t,n){if(n==="any")return!0;switch(n){case"int":case"float":case"number":return typeof t=="number";case"string":return typeof t=="string";case"bool":case"boolean":return typeof t=="boolean";case"array":return Array.isArray(t);case"object":case"dict":return typeof t=="object"&&t!==null&&!Array.isArray(t);default:return this.structs.has(n)?typeof t=="object"&&t!==null&&t.__struct_type===n:!0}}async executeBlock(t,n){let l=0;const i=[];try{for(;l<t.length;){if(t[l].value==="defer"){l++;let r=[];if(t[l].value==="{"){l++;let a=1;for(;l<t.length&&a>0;)t[l].value==="}"?a--:t[l].value==="{"&&a++,a>0&&r.push(t[l]),l++}else{for(;l<t.length&&t[l].value!==";";)r.push(t[l]),l++;l<t.length&&l++}i.push(r);continue}const e=await this.executeStatement(t,l,n);if(typeof e=="object"&&"type"in e)return e;l=e}}finally{for(;i.length>0;){const e=i.pop();await this.executeBlock(e,n)}}return l}async evaluate(t,n,l=!1){this.reset(l);const i=A(t);let e=0;for(;e<i.length;){const r=i[e];if(r.value==="struct"){e++;const a=i[e].value;e++,i[e].value==="{"&&e++;const s=[];for(;i[e].value!=="}"&&i[e].type!=="EOF";)if(i[e].type==="IDENTIFIER"){const u=i[e++].value;let c=null;i[e].value===":"&&(e++,c=i[e++].value,i[e].value===":"&&e++),s.push({name:u,type:c})}else e++;i[e].value==="}"&&e++,this.structs.set(a,{name:a,fields:s});continue}if(r.value==="def"||r.value==="defn"){e++;const a=i[e].value;e++,i[e].value==="("&&e++;const s=[];for(;i[e].value!==")"&&i[e].type!=="EOF";){if(i[e].value===","){e++;continue}const p=i[e++].value;let f=null;i[e].value===":"&&(e++,f=i[e++].value,i[e].value===":"&&e++),s.push({name:p,type:f})}i[e].value===")"&&e++;let u=null;i[e].value==="->"&&(e++,i[e].value===":"&&e++,u=i[e++].value,i[e].value===":"&&e++),i[e].value===":"&&e++;const c=this.captureBlock(i,e,p=>e=p);i[e]&&i[e].value===":;"&&e++,this.functions.set(a,{name:a,params:s,returnType:u,body:c});continue}e++}if(l)for(e=0;e<i.length;){if(["struct","def","defn"].includes(i[e].value)){for(;i[e].type!=="EOF";){if(i[e].value==="struct"&&i[e].value==="}"){e++;break}if(["def","defn"].includes(i[e].value)&&i[e].value===":;"){e++;break}if(i[e].value===":;"||i[e].value==="}"){e++;break}e++}continue}const r=await this.executeStatement(i,e,n);if(typeof r=="object"){if(r.type==="expression_result"&&r.value!==void 0){const a=s=>{if(Array.isArray(s))return`[${s.map(a).join(", ")}]`;if(typeof s=="object"&&s!==null){if(s.__struct_type){const u=Object.keys(s).filter(c=>c!=="__struct_type");return`${s.__struct_type} { ${u.map(c=>`${c}: ${a(s[c])}`).join(", ")} }`}return JSON.stringify(s)}return String(s)};n({type:"output",message:`=> ${a(r.value)}`})}if(r.type!=="expression_result")break;e=i.findIndex((a,s)=>s>=e&&a.value===";")+1}else e=r}else{let r="_main";for(e=0;e<i.length;){if(i[e].value==="entry"){r=i[e+1].value;break}e++}let a=-1;for(e=0;e<i.length;){if(i[e].value===r&&i[e+1]?.value===":"){a=e+2;break}e++}if(a!==-1){const s=this.captureBlock(i,a,u=>{});await this.executeBlock(s,n)}else n({type:"error",message:`Entry point '${r}' not found.`})}}async executeStatement(t,n,l){let i=n;if(i>=t.length)return i;const e=t[i],r=(u=0)=>t[i+u]||{value:"",type:"EOF"},a=()=>t[i++];if(["struct","def","defn"].includes(e.value)){if(e.value==="struct"){for(;r().value!=="}"&&r().type!=="EOF";)a();a()}else{for(;r().value!==":;"&&r().type!=="EOF";)a();a()}return i}if(e.value==="mut"||e.value==="let"){const u=e.value==="mut";a();const c=a().value;a();let p=null;r().value===":"&&(a(),p=a().value,r().value===":"&&a()),r().value==="="&&a();const f=await this.parseExpression(t,i,h=>i=h,l);return r().value===";"&&a(),p&&!this.checkType(f,p)&&l({type:"error",message:`Type Error: Variable '${c}' declared as '${p}' but got ${typeof f}`,line:e.line}),this.defineVar(c,f,u,p),i}if(e.type==="IDENTIFIER"&&r(1)?.value==="["){const u=e.value;a(),a();const c=await this.parseExpression(t,i,p=>i=p,l);if(r().value==="]"&&a(),r().value==="="){a();const p=await this.parseExpression(t,i,f=>i=f,l);return r().value===";"&&a(),this.assignIndex(u,c,p,e.line,l),i}}if(e.type==="IDENTIFIER"&&r(1)?.value==="="){const u=e.value;a(),a();const c=await this.parseExpression(t,i,p=>i=p,l);return r().value===";"&&a(),this.assignVar(u,c,e.line,l),i}if(e.value==="html")return a(),r().value==="{"&&a(),await this.parseHtmlBlock(t,i,u=>i=u,l),r().value==="}"&&a(),i;if(e.value==="if"){a();const u=await this.parseExpression(t,i,f=>i=f,l);r().value===":"&&a();const c=this.captureBlock(t,i,f=>i=f);r().value===":;"&&a();let p=null;if(r().value==="else"&&(a(),r().value===":"&&a(),p=this.captureBlock(t,i,f=>i=f),r().value===":;"&&a()),u){const f=await this.executeBlock(c,l);if(typeof f=="object")return f}else if(p){const f=await this.executeBlock(p,l);if(typeof f=="object")return f}return i}if(e.value==="match"){a();const u=await this.parseExpression(t,i,p=>i=p,l);r().value===":"&&a();let c=!1;for(;r().value!==":;"&&r().type!=="EOF";)if(r().value==="case"){a();const p=await this.parseExpression(t,i,h=>i=h,l);r().value===":"&&a();const f=this.captureBlock(t,i,h=>i=h);if(!c&&u===p){c=!0;const h=await this.executeBlock(f,l);if(typeof h=="object")return h}}else if(r().value==="default"){a(),r().value===":"&&a();const p=this.captureBlock(t,i,f=>i=f);if(!c){c=!0;const f=await this.executeBlock(p,l);if(typeof f=="object")return f}}else i++;return r().value===":;"&&a(),i}if(e.value==="while"){a();const u=i;await this.parseExpression(t,i,f=>i=f,l),r().value===":"&&a();const c=this.captureBlock(t,i,f=>i=f);r().value===":;"&&a();const p=i;for(;;){let f=u;if(!await this.parseExpression(t,f,T=>f=T,l))break;const v=await this.executeBlock(c,l);if(typeof v=="object"){if(v.type==="break")break;if(v.type==="return")return v}await new Promise(T=>setTimeout(T,0))}return p}if(e.value==="for"){a();const u=a().value;a(),r().value==="in"&&a();const c=await this.parseExpression(t,i,f=>i=f,l);r().value===":"&&a();const p=this.captureBlock(t,i,f=>i=f);if(r().value===":;"&&a(),Array.isArray(c)||typeof c=="string")for(const f of c){const h=new Map;h.set(u,{value:f,isMutable:!1,type:null}),this.scopeStack.push(h);const v=await this.executeBlock(p,l);if(this.scopeStack.pop(),typeof v=="object"){if(v.type==="break")break;if(v.type==="return")return v}await new Promise(T=>setTimeout(T,0))}return i}if(e.value==="print"){a(),a();const u=[];for(;r().value!==")"&&r().type!=="EOF";){if(r().value===","){a();continue}u.push(await this.parseExpression(t,i,p=>i=p,l))}r().value===")"&&a(),r().value===";"&&a();const c=p=>{if(Array.isArray(p))return`[${p.map(c).join(", ")}]`;if(typeof p=="object"&&p!==null){if(p.__struct_type){const f=Object.keys(p).filter(h=>h!=="__struct_type");return`${p.__struct_type} { ${f.map(h=>`${h}: ${c(p[h])}`).join(", ")} }`}return JSON.stringify(p)}return String(p)};return l({type:"output",message:u.map(c).join(" ")}),i}if(e.value==="return"){a();const u=[];for(;r().type!=="EOF"&&!["def","defn","_main",":;"].includes(r().value)&&(u.push(await this.parseExpression(t,i,c=>i=c,l)),r().value===",");)a();return{type:"return",value:u.length===1?u[0]:u}}if(e.value==="break")return a(),r().value===";"&&a(),{type:"break"};if(e.value==="continue")return a(),r().value===";"&&a(),{type:"continue"};const s=await this.parseExpression(t,i,u=>i=u,l);return r().value===";"&&a(),s!=null?{type:"expression_result",value:s}:i}async parseHtmlBlock(t,n,l,i){let e=n;const r=(u=0)=>t[e+u]||{value:"",type:"EOF"},a=async()=>{if(r().type!=="IDENTIFIER")return"";const u=t[e].value;e++;let c="";if(r().value==="{"){for(e++;r().value!=="}"&&r().type!=="EOF";)if(r().type==="STRING")c+=t[e].value,e++;else if(r().type==="IDENTIFIER")c+=await a();else if(r().value==="$"){e++;const p=await this.parseExpression(t,e,f=>e=f,i);c+=String(p)}else e++;r().value==="}"&&e++}else if(r().type==="STRING")c=t[e].value,e++;else if(r().value==="$"){e++;const p=await this.parseExpression(t,e,f=>e=f,i);c=String(p)}return`<${u}>${c}</${u}>`};let s="";for(;r().value!=="}"&&r().type!=="EOF";)s+=await a();return l(e),s}captureBlock(t,n,l){let i=n;const e=(u=0)=>t[i+u]||{value:"",type:"EOF"},r=()=>t[i++],a=[];let s=0;for(;i<t.length&&!(t[i].value===":;"&&s===0);)t[i].value===":;"&&s--,t[i].value===":"&&e(1).value!==";"&&s++,a.push(r());return l(i),a}async parseExpression(t,n,l,i){let e=n,r=await this.parseTerm(t,e,a=>e=a,i);for(;e<t.length&&(t[e].type==="OPERATOR"||t[e].value==="??");){const a=t[e].value;e++;const s=await this.parseTerm(t,e,c=>e=c,i);if(["-","*","/","%"].includes(a)&&(isNaN(Number(r))||isNaN(Number(s)))&&i({type:"error",message:`Runtime Warning: Invalid math operation '${r} ${a} ${s}' resulted in NaN`,line:t[e]?.line}),r&&typeof r=="object"&&r.__struct_type){const c=`${r.__struct_type}__${this.opToName(a)}`;if(this.functions.has(c)){r=await this.callFunction(c,[r,s],t[e].line,i);continue}}a==="+"?typeof r=="string"||typeof s=="string"?r=String(r)+String(s):r=r+s:a==="-"?r=r-s:a==="*"?r=r*s:a==="/"?r=r/s:a==="%"?r=r%s:a===">"?r=r>s:a==="<"?r=r<s:a==="=="?r=r===s:a==="!="?r=r!==s:a==="&&"?r=r&&s:a==="||"?r=r||s:a==="??"&&(r=r??s)}return l(e),r}opToName(t){return t==="+"?"add":t==="-"?"sub":t==="*"?"mul":t==="/"?"div":t==="=="?"eq":"op"}async parseTerm(t,n,l,i){let e=n;const r=t[e],a=(s,u=1)=>(l(e+u),s);if(r.type==="STRING"){let s=r.value;return s=s.replace(/\$([a-zA-Z_][a-zA-Z0-9_]*)/g,(u,c)=>{const p=this.getVar(c)?.value;return p!==void 0?String(p):u}),a(s)}if(r.value==="html"){e++,t[e].value==="{"&&e++;const s=await this.parseHtmlBlock(t,e,u=>e=u,i);return t[e]&&t[e].value==="}"&&e++,a(s,0)}if(r.value==="{"){e++;const s={};for(;t[e].value!=="}"&&t[e].type!=="EOF";){const u=t[e].value;e++,t[e].value===":"&&e++,s[u]=await this.parseExpression(t,e,c=>e=c,i),t[e].value===","&&e++}return t[e].value==="}"&&e++,a(s,0)}if(r.value==="["){e++;const s=[];for(;t[e].value!=="]"&&t[e].type!=="EOF";){if(t[e].value===","){e++;continue}s.push(await this.parseExpression(t,e,u=>e=u,i))}return t[e].value==="]"&&e++,a(s,0)}if(r.type==="NUMBER")return a(parseFloat(r.value));if(r.type==="CHAR")return a(r.value);if(r.type==="BOOLEAN")return a(r.value==="True");if(r.type==="IDENTIFIER"&&r.value==="null")return a(null);if(r.value==="input"){const s=t[e+1];if(s&&s.value==="("){e+=2;let u="";t[e].type==="STRING"&&(u=t[e].value,e++),t[e].value===")"&&e++,await new Promise(f=>setTimeout(f,50));const c=prompt(u),p=parseFloat(c||"");return a(isNaN(p)?c:p,0)}}if(r.type==="IDENTIFIER"){const s=t[e+1];if(this.structs.has(r.value)&&s&&s.value==="("){const u=r.value,c=this.structs.get(u);e+=2;const p=[];for(;t[e].value!==")"&&t[e].type!=="EOF";){if(t[e].value===","){e++;continue}p.push(await this.parseExpression(t,e,h=>e=h,i))}e++,p.length!==c.fields.length&&i({type:"error",message:`Struct '${u}' expects ${c.fields.length} arguments, got ${p.length}`,line:r.line});const f={__struct_type:u};return c.fields.forEach((h,v)=>{h.type&&!this.checkType(p[v],h.type)&&i({type:"error",message:`Type Error: Struct '${u}' field '${h.name}' expects '${h.type}'`,line:r.line}),f[h.name]=p[v]}),a(f,0)}if(s&&s.value==="("){const u=r.value;e+=2;const c=[];for(;t[e].value!==")"&&t[e].type!=="EOF";){if(t[e].value===","){e++;continue}c.push(await this.parseExpression(t,e,p=>e=p,i))}return e++,a(await this.callFunction(u,c,r.line,i),0)}if(s&&s.value==="?."){let u=this.getVar(r.value)?.value;for(e+=2;;){if(u==null){for(;t[e]&&(t[e].type==="IDENTIFIER"||t[e].value==="."||t[e].value==="?.");)e++;return a(null,0)}const c=t[e].value;if(e++,u=u[c],t[e]&&t[e].value!=="?.")break;e++}return a(u,0)}if(s&&(s.value==="["||s.value===".")){let u=this.getVar(r.value)?.value;for(e++;e<t.length;)if(t[e].value==="["){e++;const c=await this.parseExpression(t,e,p=>e=p,i);t[e].value==="]"&&e++,u=u?.[c]}else if(t[e].value===".")if(e++,t[e].value==="len")e++,t[e].value==="("&&(e+=2),u=Array.isArray(u)||typeof u=="string"?u.length:0;else{const c=t[e].value;e++,u=u?.[c]}else break;return a(u,0)}return a(this.getVar(r.value)?.value)}return a(null)}async callFunction(t,n,l,i){if(this.nativeFunctions.has(t))return this.nativeFunctions.get(t)(n);const e=this.functions.get(t);if(!e)return i({type:"error",message:`Undefined function '${t}'`,line:l}),null;n.length!==e.params.length&&i({type:"error",message:`Function '${t}' expects ${e.params.length} arguments, got ${n.length}`,line:l});const r=new Map;e.params.forEach((s,u)=>{s.type&&(this.checkType(n[u],s.type)||i({type:"error",message:`Type Error: Argument '${s.name}' expects type '${s.type}'`,line:l})),r.set(s.name,{value:n[u],isMutable:!1,type:s.type})}),t.startsWith("is")&&(t.includes("True")&&typeof n[0]!="boolean"&&i({type:"error",message:`Type Error: '${t}' expects Boolean`,line:l}),t.includes('"string"')&&typeof n[0]!="string"&&i({type:"error",message:`Type Error: '${t}' expects String`,line:l})),this.scopeStack.push(r);const a=await this.executeBlock(e.body,i);return this.scopeStack.pop(),typeof a=="object"&&a.type==="return"?(e.returnType&&!this.checkType(a.value,e.returnType)&&i({type:"error",message:`Type Error: Function '${t}' returned '${typeof a.value}' but expected '${e.returnType}'`,line:l}),a.value):null}}const $=new B,R=`
<div class="guide-content">
  <h3>1. Basics</h3>
  <pre>entry _main;          // Entry point
_main:
  print("Hello Kefir");
:;</pre>

  <h3>2. Variables (Typed)</h3>
  <pre>x = 10;               // Immutable (Constant)
mut y :int: = 20;     // Mutable with Type
y = 25;               // OK
let z = "text";       // Shadowing</pre>

  <h3>3. Functions (Typed)</h3>
  <pre>defn add(a :int:, b :int:) -> :int::
  return a + b

// Usage
result = add(5, 10);</pre>

  <h3>4. Structs</h3>
  <pre>struct User {
  name :string:,
  age :int:
}
mut u = User("Kefir", 25);
print(u.name);</pre>

  <h3>5. Data Structures</h3>
  <pre>// Arrays
mut arr = [1, 2, 3];
push(arr, 4);
print(arr[0]);

// Dictionaries
mut dict = { id: 1, type: "Admin" };
print(dict["type"]);</pre>

  <h3>6. Control Flow</h3>
  <pre>if x > 10: print("Big"); :;
match x:
  case 10: print("Ten"); :;
  default: print("Other"); :;
:;
while x > 0: x = x - 1; :;
for i in range(0, 5): print(i); :;</pre>

  <h3>7. Advanced</h3>
  <pre>// String Interpolation
print("Value: $x");

// HTML DSL
view = html {
  div { h1 "Title" }
};

// Defer
defer print("Cleanup");</pre>
</div>
`;document.querySelector("#app").innerHTML=`
  <div class="container">
    <div id="guide-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Kefir Syntax Guide</h2>
          <button id="close-guide">Close</button>
        </div>
        <div class="modal-body">${R}</div>
      </div>
    </div>

    <div class="panel">
      <div class="header-row">
        <h2>1. Code File</h2>
        <button id="guide-btn" class="secondary-btn">ðŸ“˜ Syntax Guide</button>
      </div>
      <input type="file" id="kf-input" accept=".kf" />
      <textarea id="code-preview" placeholder="Source code..." readonly></textarea>
      <button id="run-btn">Run File</button>
    </div>
    
    <div class="panel repl-panel">
      <h2>2. Interactive REPL</h2>
      <div id="console-output" class="terminal">
        <div class="log-msg" style="color:#646cff">Welcome to Kefir v1.1. Type 'clear' to clean.</div>
      </div>
      <div class="repl-input-container">
        <span id="prompt-label">&gt;&gt;&gt;</span>
        <input type="text" id="repl-input" autocomplete="off" spellcheck="false" />
      </div>
    </div>
  </div>
`;const j=document.querySelector("#kf-input"),S=document.querySelector("#code-preview"),w=document.querySelector("#run-btn"),y=document.querySelector("#console-output"),d=document.querySelector("#repl-input"),E=document.querySelector("#prompt-label"),N=document.querySelector("#guide-modal"),M=document.querySelector("#guide-btn"),V=document.querySelector("#close-guide");M?.addEventListener("click",()=>N?.classList.remove("hidden"));V?.addEventListener("click",()=>N?.classList.add("hidden"));let F="";const g=[];let m=-1,b="",x=0;function I(o,t=!1){if(!y)return;const n=document.createElement("div");n.className=o.type==="error"?"log-error":"log-msg",o.type==="error"?n.innerText=`ðŸ›‘ ${o.message}`:n.innerText=t?`${o.message}`:o.message,y.appendChild(n),y.scrollTop=y.scrollHeight}j?.addEventListener("change",o=>{const t=o.target.files?.[0];if(!t||!t.name.endsWith(".kf")){alert("Please upload a .kf file");return}const n=new FileReader;n.onload=l=>{F=l.target?.result,S&&(S.value=F)},n.readAsText(t)});w?.addEventListener("click",async()=>{F&&(y&&(y.innerHTML='<div class="log-msg">--- Running File ---</div>'),w&&(w.textContent="Running...",w.disabled=!0),await $.evaluate(F,o=>I(o),!1),w&&(w.textContent="Run File",w.disabled=!1))});d?.addEventListener("keydown",async o=>{if(o.key==="ArrowUp")o.preventDefault(),m<g.length-1&&(m++,d.value=g[g.length-1-m]);else if(o.key==="ArrowDown")o.preventDefault(),m>0?(m--,d.value=g[g.length-1-m]):m===0&&(m=-1,d.value="");else if(o.key==="Enter"){const t=d.value,n=t.trim();if(!n&&b==="")return;const l=document.createElement("div");if(l.className="log-input",l.innerText=(b?"... ":">>> ")+t,y?.appendChild(l),y.scrollTop=y.scrollHeight,d.value="",n==="clear"||n==="cls"){y&&(y.innerHTML=""),b="",x=0,E&&(E.innerText=">>>");return}b?b+=`
`+t:b=t,(n.endsWith(":")||n.endsWith("{"))&&x++,(n===":;"||n==="}")&&(x=Math.max(0,x-1)),x>0?E&&(E.innerText="..."):(n!==""&&(g.push(b.trim()),m=-1,d.disabled=!0,await $.evaluate(b,i=>I(i,!0),!0),d.disabled=!1),b="",x=0,E&&(E.innerText=">>>")),d.focus()}});document.querySelector(".repl-panel")?.addEventListener("click",()=>{d?.focus()});
